<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="styles.css" />
    <title>BookHub - Cadastro</title>
  </head>
  <body>
    <div class="formulario">
      <h1>Cadastro</h1>
      <form class="form-cadastro">
        <div class="caixa-formulario">
          <input type="text" id="nome" name="nome" placeholder="Nome" required />
        </div>
        <div class="caixa-formulario">
          <input type="email" id="email" name="email" placeholder="E-mail" required />
        </div>
        <div class="caixa-formulario">
          <input type="text" id="login" name="login" placeholder="Login" required />
        </div>
        <div class="caixa-formulario">
          <input type="password" id="senha" name="password" placeholder="Senha" required />
        </div>
        <div class="caixa-formulario">
          <input type="text" id="endereco" name="endereco" placeholder="Endereço" required />
        </div>
        <div class="caixa-formulario">
          <input type="tel" id="telefone" name="telefone" placeholder="(XX) XXXXX-XXXX" required />
        </div>
        <div class="caixa-formulario">
          <select id="tipo" name="tipo" required>
            <option value="">Selecione o tipo de usuário</option>
            <option value="admin">Administrador</option>
            <option value="bibliotecario">Bibliotecário</option>
            <option value="usuario">Usuário Comum</option>
          </select>
        </div>
        <div class="caixa-botoes">
          <button type="submit" class="cadastrar" id="cadastrado">Cadastrar</button>
          <button type="button" class="retornar" id="voltar">Retornar</button>
        </div>
        <div class="link-registro">
          <p>Já tem conta? <a href="login.html">Entrar</a></p>
        </div>
      </form>

      <script>
        document.addEventListener("DOMContentLoaded", function () {
          document.getElementById("voltar").addEventListener("click", () => {
            window.location.href = "index.html";
          });

          async function cadastrarUsuario(event) {
            event.preventDefault();

            const nome = document.getElementById("nome").value;
            const email = document.getElementById("email").value;
            const login = document.getElementById("login").value;
            const password = document.getElementById("senha").value;
            const endereco = document.getElementById("endereco").value;
            const telefone = document.getElementById("telefone").value;
            const tipo = document.getElementById("tipo").value;

            if (!nome || !email || !login || !password || !endereco || !telefone || !tipo) {
              alert("Todos os campos são obrigatórios!");
              return;
            }

            let role;
            switch (tipo) {
              case "admin":
                role = "ADMIN";
                break;
              case "bibliotecario":
                role = "LIBRARIAN";
                break;
              case "usuario":
                role = "USER";
                break;
              default:
                role = "USER";
            }

            const dadosUser = { nome, email, login, password, endereco, telefone, role };
            console.log("Dados a serem enviados:", dadosUser);

            try {
              const response = await fetch("http://localhost:8080/auth/register", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(dadosUser)
              });

              if (response.ok) {
                await response.json();
                alert("Usuário cadastrado com sucesso!");
                document.querySelector(".form-cadastro").reset();
                window.location.href = "login.html";
              } else {
                const erro = await response.text();
                console.error("Erro do servidor:", erro);
                alert("Erro ao cadastrar: " + erro);
              }
            } catch (error) {
              console.error("Erro de conexão:", error);
              alert("Erro de conexão com o servidor");
            }
          }

          document.querySelector(".form-cadastro").addEventListener("submit", cadastrarUsuario);
        });
      </script>
    </div>
  </body>
</html>
